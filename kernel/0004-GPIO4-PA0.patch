From 756534d63e7a6d79a97f5b1b0a4bf7b625f1aeb2 Mon Sep 17 00:00:00 2001
From: YouMeng <36076779@qq.com>
Date: Mon, 29 Jul 2024 17:34:30 +0800
Subject: [PATCH 4/5] =?UTF-8?q?=E6=B7=BB=E5=8A=A0=E5=85=85=E7=94=B5?=
 =?UTF-8?q?=E6=A3=80=E6=B5=8B=E5=BC=95=E8=84=9AGPIO4=20PA0?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: I2792911ac4b190079013ea424d3e632c0d9536e3
---
 .../boot/dts/rockchip/tspi-rk3566-user-v10.dts      | 13 +++++++++++++
 arch/arm64/configs/rockchip_linux_defconfig         |  1 +
 2 files changed, 14 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts b/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
index bb08df745b3e..ddb94d27b82f 100755
--- a/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
+++ b/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
@@ -118,6 +118,14 @@
 			linux,code = <KEY_VOLUMEDOWN>;
 		};
 	};
+
+	gpio-charger {
+		compatible = "gpio-charger";
+		charger-type = "mains";
+		gpios = <&gpio4 RK_PA0 GPIO_ACTIVE_LOW>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&ac_present_ap>;
+	};
 };
 
 &pinctrl {
@@ -146,6 +154,11 @@
 			rockchip,pins = <0 RK_PC7 RK_FUNC_GPIO &pcfg_pull_up>;
 		};
 	};
+	charger {
+		ac_present_ap: ac-present-ap {
+			rockchip,pins = <4 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
 };
 
 //用户三色灯
diff --git a/arch/arm64/configs/rockchip_linux_defconfig b/arch/arm64/configs/rockchip_linux_defconfig
index e52a3365521d..a738a380ef0a 100644
--- a/arch/arm64/configs/rockchip_linux_defconfig
+++ b/arch/arm64/configs/rockchip_linux_defconfig
@@ -518,6 +518,7 @@ CONFIG_POWER_AVS=y
 CONFIG_ROCKCHIP_IODOMAIN=y
 CONFIG_POWER_RESET_GPIO=y
 CONFIG_SYSCON_REBOOT_MODE=y
+CONFIG_CHARGER_GPIO=y
 CONFIG_BATTERY_CW2015=y
 CONFIG_EC20_POWER=y
 CONFIG_THERMAL=y
-- 
2.34.1

