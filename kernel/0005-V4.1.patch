From f8ffa60e4066322cc1888a15fb247b8cfa0211ef Mon Sep 17 00:00:00 2001
From: YouMeng <36076779@qq.com>
Date: Wed, 21 Aug 2024 22:19:16 +0800
Subject: [PATCH 5/5] =?UTF-8?q?=E5=AF=B9=E5=BA=94=E7=A1=AC=E4=BB=B6V4.1?=
 =?UTF-8?q?=E7=89=88=E6=9C=AC,=E4=BF=AE=E6=94=B9=E4=BC=A0=E6=84=9F?=
 =?UTF-8?q?=E5=99=A8=E6=96=B9=E5=90=91,=E8=B0=83=E6=95=B4=E7=86=84?=
 =?UTF-8?q?=E5=B1=8F=E6=8C=89=E9=94=AE=E5=BB=B6=E6=97=B6?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: I718678bd697e11e3df11e573116481de52c81994
---
 .../dts/rockchip/tspi-rk3566-user-v10.dts     | 53 +++++++------------
 arch/arm64/configs/rockchip_linux_defconfig   |  1 -
 drivers/input/sensors/compass/Kconfig         |  2 +-
 3 files changed, 19 insertions(+), 37 deletions(-)

diff --git a/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts b/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
index ddb94d27b82f..7ad95a4219a3 100755
--- a/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
+++ b/arch/arm64/boot/dts/rockchip/tspi-rk3566-user-v10.dts
@@ -102,7 +102,7 @@
 			label = "GPIO Key Power";
 			gpios = <&gpio0 RK_PA5 GPIO_ACTIVE_LOW>;
 			linux,code = <KEY_POWER>;
-			debounce-interval = <100>;
+			debounce-interval = <10>;
 			wakeup-source;
 		};
 
@@ -122,7 +122,7 @@
 	gpio-charger {
 		compatible = "gpio-charger";
 		charger-type = "mains";
-		gpios = <&gpio4 RK_PA0 GPIO_ACTIVE_LOW>;
+		gpios = <&gpio4 RK_PA2 GPIO_ACTIVE_LOW>;
 		pinctrl-names = "default";
 		pinctrl-0 = <&ac_present_ap>;
 	};
@@ -140,6 +140,11 @@
 			rockchip,pins = <3 RK_PD7 RK_FUNC_GPIO &pcfg_pull_none>;
 		};
 	};
+	ak8963 {
+		ak8963_irq_gpio: ak8963_irq_gpio {
+			rockchip,pins = <4 RK_PA3 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+	};
 
 	keys {
 		pwr_key: pwr-key {
@@ -156,7 +161,7 @@
 	};
 	charger {
 		ac_present_ap: ac-present-ap {
-			rockchip,pins = <4 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>;
+			rockchip,pins = <4 RK_PA2 RK_FUNC_GPIO &pcfg_pull_up>;
 		};
 	};
 };
@@ -190,7 +195,7 @@
 		irq_enable = <0>;
 		poll_delay_ms = <30>;
 		type = <SENSOR_TYPE_ACCEL>;
-		layout = <5>;
+		layout = <6>;
 	};
 
 	mpu6050_gyro: mpu-gyro@68 {
@@ -200,17 +205,20 @@
 		irq_enable = <0>;
 		poll_delay_ms = <30>;
 		type = <SENSOR_TYPE_GYROSCOPE>;
-		layout = <5>;
+		layout = <6>;
 	};
 
-	ak09918_compass: ak09918_compass@c {
-		compatible = "ak09911";
-		reg = <0x0c>;
+	ak8963_compass: ak8963-compass@0d {
+		status = "okay";
+		compatible = "ak8963";
+		pinctrl-names = "default";
+		pinctrl-0 = <&ak8963_irq_gpio>;
+		reg = <0x0d>;
 		type = <SENSOR_TYPE_COMPASS>;
+		irq-gpio = <&gpio4 RK_PA3 IRQ_TYPE_EDGE_RISING>;
 		irq_enable = <0>;
 		poll_delay_ms = <30>;
-		layout = <1>;
-		status = "okay";
+		layout = <5>; 
 	};
 
 	cw2015@62 {
@@ -234,31 +242,6 @@
 &i2c2 {
 	status = "okay";
 
-	/*添加你的I2C设备参考
-	gt1x: gt1x@14 {
-		compatible = "goodix,gt1x";
-		reg = <0x14>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&touch_gpio>;
-		goodix,rst-gpio = <&gpio0 RK_PB6 GPIO_ACTIVE_HIGH>;
-		goodix,irq-gpio = <&gpio0 RK_PB5 IRQ_TYPE_LEVEL_LOW>;
-	};*/
-	// mpu6050@68 {
-	// 	compatible = "invensense,mpu6050";
-	// 	status = "okay";
-	// 	pinctrl-names = "default";
-	// 	pinctrl-0 = <&mpu6050_irq_gpio>;
-	// 	reg = <0x68>;
-	// 	irq-gpio = <&gpio3 RK_PA1 IRQ_TYPE_EDGE_RISING>;
-	// 	mpu-int_config = <0x10>;
-	// 	mpu-level_shifter = <0>;
-	// 	mpu-orientation = <0 1 0 1 0 0 0 0 1>;
-	// 	orientation-x= <0>;
-	// 	orientation-y= <1>;
-	// 	orientation-z= <0>;
-	// 	support-hw-poweroff = <0>;
-	// 	mpu-debug = <0>;
-	// };
 };
 
 &i2c3 {
diff --git a/arch/arm64/configs/rockchip_linux_defconfig b/arch/arm64/configs/rockchip_linux_defconfig
index a738a380ef0a..2e1e01ffe8a4 100644
--- a/arch/arm64/configs/rockchip_linux_defconfig
+++ b/arch/arm64/configs/rockchip_linux_defconfig
@@ -837,7 +837,6 @@ CONFIG_IIO=y
 CONFIG_IIO_BUFFER_CB=y
 CONFIG_ROCKCHIP_SARADC=y
 CONFIG_INV_MPU6050_I2C=y
-CONFIG_AK09911=y
 CONFIG_PWM=y
 CONFIG_PWM_ROCKCHIP=y
 CONFIG_PHY_ROCKCHIP_CSI2_DPHY=y
diff --git a/drivers/input/sensors/compass/Kconfig b/drivers/input/sensors/compass/Kconfig
index 91a19ffe23ea..41bdf1f95c4e 100644
--- a/drivers/input/sensors/compass/Kconfig
+++ b/drivers/input/sensors/compass/Kconfig
@@ -47,7 +47,7 @@ config COMPASS_AK09911
   will be called AK09911.
 
 config COMPASS_AK09918
-  tristate "Asahi Kasei AK09911 3-Axis Magnetometer"
+  tristate "Asahi Kasei AK09918 3-Axis Magnetometer"
   depends on I2C
   help
   Say yes here to build support for Asahi Kasei AK09918 3-Axis Magnetometer.
-- 
2.34.1

